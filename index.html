<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lucy's AI Digest - Enhanced Analytics</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand-orange': '#f8a352',
                        'brand-red': '#d94236',
                        'brand-dark-red': '#b5332e',
                        'brand-light-orange': '#ffc680',
                    }
                }
            }
        }
    </script>
    <style>
        .brand-gradient {
            background: linear-gradient(135deg, #f8a352 0%, #d94236 100%);
        }
        
        .metric-card {
            background: linear-gradient(135deg, #f8a352 0%, #d94236 100%);
            color: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease;
        }
        
        .metric-card:hover {
            transform: translateY(-5px);
        }
        
        .analytics-card {
            background: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border-top: 4px solid #f8a352;
        }
        
        .chart-container {
            height: 300px;
            position: relative;
        }
        
        .tab-button {
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            border-radius: 0.5rem 0.5rem 0 0;
            transition: all 0.2s ease;
            border-bottom: 3px solid transparent;
        }
        
        .tab-button.active {
            background: white;
            color: #d94236;
            border-bottom-color: #f8a352;
        }
        
        .tab-button:not(.active) {
            background: #f3f4f6;
            color: #6b7280;
        }
        
        .tab-button:not(.active):hover {
            background: #e5e7eb;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .keyword-tag {
            background: linear-gradient(135deg, #f8a352, #d94236);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 1.5rem;
            font-weight: 600;
            display: inline-block;
            margin: 0.25rem;
            transition: transform 0.2s ease;
        }
        
        .keyword-tag:hover {
            transform: scale(1.05);
        }
        
        .hashtag-tag {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.875rem;
            display: inline-block;
            margin: 0.25rem;
        }
        
        .source-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 0.5rem;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .source-podcast {
            background: #fef3c7;
            color: #92400e;
        }
        
        .source-news {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .source-reddit {
            background: #fecaca;
            color: #991b1b;
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #f8a352 0%, #d94236 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <header class="relative overflow-hidden bg-white shadow-lg mb-8 py-8">
        <div class="absolute inset-0 brand-gradient opacity-10"></div>
        <div class="container mx-auto relative z-10 text-center">
            <h1 class="text-4xl font-bold gradient-text mb-4">ü§ñ Lucy's AI Intelligence Dashboard</h1>
            <h2 class="text-xl text-gray-700 mb-2">Advanced Social Listening & News Analytics</h2>
            <p class="text-brand-orange" id="dashboard-date">Loading...</p>
            <p class="text-sm text-gray-600 mt-2" id="article-summary">Loading comprehensive analytics...</p>
        </div>
    </header>

    <div class="container mx-auto px-4">
        <div class="mb-8">
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex space-x-8 justify-center">
                    <button class="tab-button active" data-tab="overview">
                        üìä Analytics Overview
                    </button>
                    <button class="tab-button" data-tab="articles">
                        üì∞ Articles & News
                    </button>
                    <button class="tab-button" data-tab="social">
                        üåê Social Intelligence
                    </button>
                    <button class="tab-button" data-tab="trends">
                        üìà AI Trends
                    </button>
                </nav>
            </div>
        </div>

        <div id="overview-tab" class="tab-content active">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="metric-card pulse-animation">
                    <div class="text-3xl font-bold" id="total-posts">0</div>
                    <div class="text-sm opacity-90">Social Posts Analyzed</div>
                </div>
                <div class="metric-card">
                    <div class="text-3xl font-bold" id="total-reach">0</div>
                    <div class="text-sm opacity-90">Combined Reach</div>
                </div>
                <div class="metric-card">
                    <div class="text-3xl font-bold" id="ai-mentions">0</div>
                    <div class="text-sm opacity-90">AI Mentions</div>
                </div>
                <div class="metric-card">
                    <div class="text-3xl font-bold" id="engagement-total">0</div>
                    <div class="text-sm opacity-90">Total Engagement</div>
                </div>
            </div>

            <div class="analytics-card mb-8">
                <h3 class="text-2xl font-bold gradient-text mb-6">ü§ñ Top AI Keywords & Mentions</h3>
                <div id="ai-keywords-display" class="text-center">
                    <div class="text-gray-500">Loading AI keywords...</div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <div class="analytics-card">
                    <h3 class="text-xl font-bold text-brand-red mb-4">üòä Sentiment Analysis</h3>
                    <div class="chart-container">
                        <canvas id="sentiment-overview-chart"></canvas>
                    </div>
                </div>
                
                <div class="analytics-card">
                    <h3 class="text-xl font-bold text-brand-red mb-4">üì∞ Content Sources</h3>
                    <div class="chart-container">
                        <canvas id="sources-overview-chart"></canvas>
                    </div>
                </div>
                
                <div class="analytics-card">
                    <h3 class="text-xl font-bold text-brand-red mb-4">‚è∞ Peak Activity Hours</h3>
                    <div class="chart-container">
                        <canvas id="hourly-overview-chart"></canvas>
                    </div>
                </div>
                
                <div class="analytics-card">
                    <h3 class="text-xl font-bold text-brand-red mb-4">üåç Geographic Distribution</h3>
                    <div class="chart-container">
                        <canvas id="country-overview-chart"></canvas>
                    </div>
                </div>
            </div>

            <div class="analytics-card mb-8">
                <h3 class="text-xl font-bold text-brand-red mb-4">‚≠ê Content Quality Insights</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="text-center p-4 bg-green-50 rounded-lg">
                        <div class="text-2xl font-bold text-green-600" id="high-quality-count">0</div>
                        <div class="text-sm text-green-700">High Quality Posts</div>
                    </div>
                    <div class="text-center p-4 bg-blue-50 rounded-lg">
                        <div class="text-2xl font-bold text-blue-600" id="avg-quality-score">0</div>
                        <div class="text-sm text-blue-700">Average Quality Score</div>
                    </div>
                    <div class="text-center p-4 bg-purple-50 rounded-lg">
                        <div class="text-2xl font-bold text-purple-600" id="avg-engagement-rate">0%</div>
                        <div class="text-sm text-purple-700">Average Engagement Rate</div>
                    </div>
                </div>
            </div>
        </div>

        <div id="articles-tab" class="tab-content">
            <div class="flex flex-col lg:flex-row gap-6">
                <div class="lg:w-64 bg-white rounded-lg shadow p-6 border-t-4 border-brand-orange">
                    <h3 class="font-bold text-brand-red mb-4">üîç Filter Articles</h3>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Search</label>
                        <input type="text" id="search-input" placeholder="Search articles..." 
                               class="w-full p-2 border border-gray-300 rounded-md focus:ring-brand-orange focus:border-brand-orange">
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Source Type</label>
                        <select id="source-filter" class="w-full p-2 border border-gray-300 rounded-md focus:ring-brand-orange focus:border-brand-orange">
                            <option value="all">All Sources</option>
                            <option value="PODCAST">Podcasts</option>
                            <option value="ONLINE_NEWS">Online News</option>
                            <option value="REDDIT">Reddit</option>
                        </select>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Sentiment</label>
                        <select id="sentiment-filter" class="w-full p-2 border border-gray-300 rounded-md focus:ring-brand-orange focus:border-brand-orange">
                            <option value="all">All Sentiments</option>
                            <option value="very positive">Very Positive</option>
                            <option value="positive">Positive</option>
                            <option value="neutral">Neutral</option>
                            <option value="negative">Negative</option>
                        </select>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Quality</label>
                        <select id="quality-filter" class="w-full p-2 border border-gray-300 rounded-md focus:ring-brand-orange focus:border-brand-orange">
                            <option value="all">All Quality</option>
                            <option value="high">High Quality Only</option>
                            <option value="medium">Medium+ Quality</option>
                        </select>
                    </div>
                </div>

                <div class="flex-1">
                    <div class="bg-white rounded-lg shadow p-6 border-t-4 border-brand-orange">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold text-brand-red">üì∞ AI Articles & News</h2>
                            <div class="text-sm text-gray-500" id="articles-showing">Showing 0 articles</div>
                        </div>
                        
                        <div id="articles-container" class="space-y-4">
                            <div class="text-center py-8 text-gray-500">Loading articles...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="social-tab" class="tab-content">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="analytics-card text-center">
                    <div class="text-3xl font-bold text-brand-orange" id="social-posts">0</div>
                    <div class="text-sm text-gray-600">Social Posts</div>
                </div>
                <div class="analytics-card text-center">
                    <div class="text-3xl font-bold text-blue-600" id="social-reach">0</div>
                    <div class="text-sm text-gray-600">Estimated Reach</div>
                </div>
                <div class="analytics-card text-center">
                    <div class="text-3xl font-bold text-green-600" id="positive-sentiment">0%</div>
                    <div class="text-sm text-gray-600">Positive Sentiment</div>
                </div>
                <div class="analytics-card text-center">
                    <div class="text-3xl font-bold text-purple-600" id="peak-hour">--:--</div>
                    <div class="text-sm text-gray-600">Peak Hour</div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <div class="analytics-card">
                    <h3 class="text-xl font-bold text-brand-red mb-4">üìä Hourly Activity Pattern</h3>
                    <div class="chart-container">
                        <canvas id="hourly-pattern-chart"></canvas>
                    </div>
                </div>
                
                <div class="analytics-card">
                    <h3 class="text-xl font-bold text-brand-red mb-4">üì∞ Source Distribution</h3>
                    <div class="chart-container">
                        <canvas id="source-distribution-chart"></canvas>
                    </div>
                </div>
                
                <div class="analytics-card">
                    <h3 class="text-xl font-bold text-brand-red mb-4">üòä Detailed Sentiment</h3>
                    <div class="chart-container">
                        <canvas id="sentiment-detailed-chart"></canvas>
                    </div>
                </div>
                
                <div class="analytics-card">
                    <h3 class="text-xl font-bold text-brand-red mb-4">üåç Global Reach</h3>
                    <div class="chart-container">
                        <canvas id="geographic-chart"></canvas>
                    </div>
                </div>
            </div>

            <div class="analytics-card">
                <h3 class="text-xl font-bold text-brand-red mb-4">#Ô∏è‚É£ Trending Hashtags & Topics</h3>
                <div id="hashtags-display" class="text-center">
                    <div class="text-gray-500">Loading hashtags...</div>
                </div>
            </div>
        </div>

        <div id="trends-tab" class="tab-content">
            <div class="analytics-card mb-8">
                <h3 class="text-2xl font-bold gradient-text mb-6">üöÄ AI Trend Analysis</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="text-center p-6 bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg">
                        <div class="text-2xl font-bold text-blue-600" id="ai-total-mentions">0</div>
                        <div class="text-sm text-blue-700">Total AI Mentions</div>
                    </div>
                    <div class="text-center p-6 bg-gradient-to-br from-green-50 to-green-100 rounded-lg">
                        <div class="text-2xl font-bold text-green-600" id="trending-topics">0</div>
                        <div class="text-sm text-green-700">Trending AI Topics</div>
                    </div>
                    <div class="text-center p-6 bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg">
                        <div class="text-2xl font-bold text-purple-600" id="dominant-category">Loading</div>
                        <div class="text-sm text-purple-700">Dominant AI Category</div>
                    </div>
                </div>
            </div>

            <div class="analytics-card mb-8">
                <h3 class="text-xl font-bold text-brand-red mb-4">ü§ñ AI Keywords Breakdown</h3>
                <div class="chart-container">
                    <canvas id="ai-keywords-chart"></canvas>
                </div>
            </div>

            <div class="analytics-card mb-8">
                <h3 class="text-xl font-bold text-brand-red mb-4">üìÖ AI Discussion Patterns</h3>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-semibold text-gray-700 mb-3">Peak Discussion Times</h4>
                        <div id="peak-times-display">Loading...</div>
                    </div>
                    <div>
                        <h4 class="font-semibold text-gray-700 mb-3">Weekly Activity</h4>
                        <div id="weekly-activity-display">Loading...</div>
                    </div>
                </div>
            </div>

            <div class="analytics-card">
                <h3 class="text-xl font-bold text-brand-red mb-4">üèÜ Top Performing AI Content</h3>
                <div id="top-content-display">Loading top content...</div>
            </div>
        </div>
    </div>

    <div id="article-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-lg max-w-4xl max-h-90vh overflow-y-auto p-6">
            <div class="flex justify-between items-start mb-4">
                <h2 class="text-2xl font-bold text-brand-red">Article Details</h2>
                <button id="close-modal" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            <div id="modal-content">Loading...</div>
        </div>
    </div>

    <footer class="text-center text-gray-600 text-sm mt-12 mb-8 p-6 bg-white rounded-lg shadow border-t-4 border-brand-orange">
        <p>ü§ñ Enhanced AI Intelligence Dashboard with Social Listening Analytics</p>
        <p class="mt-2">Analyzing <span id="footer-posts">0</span> social posts with <span id="footer-mentions">0</span> AI mentions | Contact: <a href="mailto:lucy.ferguson@syneoshealth.com" class="text-brand-red hover:underline">lucy.ferguson@syneoshealth.com</a></p>
    </footer>

    <script>
        // Global variables
        let dashboardData = null;
        let allArticles = [];
        let filteredArticles = [];
        let pulsarAnalytics = null;
        let chartInstances = {};

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            // Tab switching
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', function() {
                    const targetTab = this.getAttribute('data-tab');
                    switchTab(targetTab);
                });
            });

            // Modal functionality
            document.getElementById('close-modal').addEventListener('click', function() {
                document.getElementById('article-modal').classList.add('hidden');
            });

            // Load data
            loadDashboardData();
        });

        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`${tabName}-tab`).classList.add('active');
        }

        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toLocaleString();
        }

        function loadDashboardData() {
            fetch('data/latest_dashboard_data.json')
                .then(response => response.json())
                .then(data => {
                    dashboardData = data;
                    allArticles = data.articles || [];
                    pulsarAnalytics = data.pulsarAnalytics || {};
                    
                    // Update basic info
                    updateBasicInfo(data);
                    
                    // Load analytics if available
                    if (pulsarAnalytics && Object.keys(pulsarAnalytics).length > 0) {
                        loadEnhancedAnalytics(pulsarAnalytics);
                    }
                    
                    // Load articles
                    loadArticles();
                    
                    console.log('Dashboard loaded with enhanced analytics:', pulsarAnalytics);
                })
                .catch(error => {
                    console.error('Error loading dashboard data:', error);
                });
        }

        function updateBasicInfo(data) {
            const generatedAt = new Date(data.metadata.generatedAt);
            document.getElementById('dashboard-date').textContent = 
                `Last Updated: ${generatedAt.toLocaleDateString('en-US', { 
                    year: 'numeric', month: 'long', day: 'numeric' 
                })}`;
            
            const totalArticles = data.metadata.articleCount;
            const newArticles = data.metadata.newArticlesThisWeek || 0;
            document.getElementById('article-summary').textContent = 
                `${totalArticles} articles analyzed (${newArticles} new this week)`;
        }

        function loadEnhancedAnalytics(analytics) {
            // Combine analytics from all therapy areas
            let totalPosts = 0;
            let totalReach = 0;
            let totalEngagement = 0;
            let allAiKeywords = {};
            let allHashtags = {};
            let combinedSentiment = {};
            let combinedSources = {};
            let combinedCountries = {};
            let combinedHourly = {};

            Object.values(analytics).forEach(areaAnalytics => {
                if (areaAnalytics && areaAnalytics.overview) {
                    totalPosts += areaAnalytics.overview.total_posts || 0;
                    totalReach += areaAnalytics.overview.total_reach || 0;
                    totalEngagement += areaAnalytics.overview.total_engagement || 0;
                    
                    // Combine AI keywords
                    if (areaAnalytics.ai_keywords) {
                        areaAnalytics.ai_keywords.forEach(kw => {
                            allAiKeywords[kw.keyword] = (allAiKeywords[kw.keyword] || 0) + kw.count;
                        });
                    }
                    
                    // Combine hashtags
                    if (areaAnalytics.hashtags) {
                        areaAnalytics.hashtags.forEach(ht => {
                            allHashtags[ht.hashtag] = (allHashtags[ht.hashtag] || 0) + ht.count;
                        });
                    }
                    
                    // Combine distributions
                    Object.assign(combinedSentiment, areaAnalytics.sentiment_distribution || {});
                    Object.assign(combinedSources, areaAnalytics.source_distribution || {});
                    Object.assign(combinedCountries, areaAnalytics.country_distribution || {});
                    Object.assign(combinedHourly, areaAnalytics.time_patterns?.hourly || {});
                }
            });

            // Update overview metrics
            document.getElementById('total-posts').textContent = formatNumber(totalPosts);
            document.getElementById('total-reach').textContent = formatNumber(totalReach);
            document.getElementById('ai-mentions').textContent = formatNumber(Object.values(allAiKeywords).reduce((a, b) => a + b, 0));
            document.getElementById('engagement-total').textContent = formatNumber(totalEngagement);

            // Update quality metrics
            const firstArea = Object.values(analytics)[0];
            if (firstArea && firstArea.overview) {
                document.getElementById('high-quality-count').textContent = firstArea.overview.high_quality_posts || 0;
                document.getElementById('avg-quality-score').textContent = (firstArea.overview.avg_quality_score || 0).toFixed(2);
                document.getElementById('avg-engagement-rate').textContent = (firstArea.overview.avg_engagement_rate || 0).toFixed(2) + '%';
            }

            // Update social tab metrics
            document.getElementById('social-posts').textContent = formatNumber(totalPosts);
            document.getElementById('social-reach').textContent = formatNumber(totalReach);
            
            // Calculate positive sentiment percentage
            const totalSentimentPosts = Object.values(combinedSentiment).reduce((a, b) => a + b, 0);
            const positiveCount = (combinedSentiment['positive'] || 0) + (combinedSentiment['very positive'] || 0);
            const positivePercentage = totalSentimentPosts > 0 ? ((positiveCount / totalSentimentPosts) * 100).toFixed(1) : 0;
            document.getElementById('positive-sentiment').textContent = positivePercentage + '%';
            
            // Find peak hour
            const peakHourEntry = Object.entries(combinedHourly).sort((a, b) => b[1] - a[1])[0];
            document.getElementById('peak-hour').textContent = peakHourEntry ? `${peakHourEntry[0]}:00` : '--:--';

            // Update footer
            document.getElementById('footer-posts').textContent = formatNumber(totalPosts);
            document.getElementById('footer-mentions').textContent = formatNumber(Object.values(allAiKeywords).reduce((a, b) => a + b, 0));

            // Display AI keywords
            displayAIKeywords(allAiKeywords);
            
            // Display hashtags
            displayHashtags(allHashtags);
            
            // Create charts
            createEnhancedCharts(combinedSentiment, combinedSources, combinedHourly, combinedCountries, allAiKeywords);
            
            // Update trends tab
            updateTrendsTab(allAiKeywords, combinedHourly, firstArea);
        }

        function displayAIKeywords(keywords) {
            const container = document.getElementById('ai-keywords-display');
            const sortedKeywords = Object.entries(keywords).sort((a, b) => b[1] - a[1]).slice(0, 10);
            
            container.innerHTML = sortedKeywords.map(([keyword, count]) => {
                const fontSize = Math.min(2, Math.max(1, Math.log(count) / 3));
                return `<span class="keyword-tag" style="font-size: ${fontSize}rem; margin: 0.5rem;">
                    ${keyword}: ${formatNumber(count)}
                </span>`;
            }).join('');
        }

        function displayHashtags(hashtags) {
            const container = document.getElementById('hashtags-display');
            const sortedHashtags = Object.entries(hashtags).sort((a, b) => b[1] - a[1]).slice(0, 15);
            
            if (sortedHashtags.length === 0) {
                container.innerHTML = '<div class="text-gray-500">No hashtags found in content</div>';
                return;
            }
            
            container.innerHTML = sortedHashtags.map(([hashtag, count]) => 
                `<span class="hashtag-tag">#${hashtag} (${count})</span>`
            ).join('');
        }

        function createEnhancedCharts(sentiment, sources, hourly, countries, aiKeywords) {
            // Create all charts
            createSentimentChart(sentiment);
            createSourcesChart(sources);
            createHourlyChart(hourly);
            createCountryChart(countries);
            createAIKeywordsChart(aiKeywords);
        }

        function createSentimentChart(sentimentData) {
            const ctx = document.getElementById('sentiment-overview-chart').getContext('2d');
            
            if (chartInstances.sentiment) {
                chartInstances.sentiment.destroy();
            }

            const colors = {
                'very positive': '#22c55e',
                'positive': '#65a30d',
                'neutral': '#64748b',
                'negative': '#ef4444',
                'very negative': '#dc2626'
            };

            chartInstances.sentiment = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(sentimentData),
                    datasets: [{
                        data: Object.values(sentimentData),
                        backgroundColor: Object.keys(sentimentData).map(key => colors[key] || '#64748b'),
                        borderWidth: 3,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                font: { size: 12 }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.parsed / total) * 100).toFixed(1);
                                    return `${context.label}: ${context.parsed} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });

            // Also create detailed sentiment chart
            createDetailedSentimentChart(sentimentData);
        }

        function createDetailedSentimentChart(sentimentData) {
            const ctx = document.getElementById('sentiment-detailed-chart').getContext('2d');
            
            if (chartInstances.sentimentDetailed) {
                chartInstances.sentimentDetailed.destroy();
            }

            const colors = {
                'very positive': '#22c55e',
                'positive': '#65a30d', 
                'neutral': '#64748b',
                'negative': '#ef4444',
                'very negative': '#dc2626'
            };

            chartInstances.sentimentDetailed = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(sentimentData),
                    datasets: [{
                        label: 'Posts',
                        data: Object.values(sentimentData),
                        backgroundColor: Object.keys(sentimentData).map(key => colors[key] || '#64748b'),
                        borderRadius: 8,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { precision: 0 }
                        }
                    },
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
        }

        function createSourcesChart(sourcesData) {
            const ctx = document.getElementById('sources-overview-chart').getContext('2d');
            
            if (chartInstances.sources) {
                chartInstances.sources.destroy();
            }

            const sourceColors = {
                'PODCAST': '#f59e0b',
                'ONLINE_NEWS': '#3b82f6',
                'REDDIT': '#ef4444',
                'SOCIAL_MEDIA': '#8b5cf6'
            };

            chartInstances.sources = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: Object.keys(sourcesData),
                    datasets: [{
                        data: Object.values(sourcesData),
                        backgroundColor: Object.keys(sourcesData).map(key => sourceColors[key] || '#64748b'),
                        borderWidth: 3,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                font: { size: 12 }
                            }
                        }
                    }
                }
            });

            // Also create source distribution chart
            createSourceDistributionChart(sourcesData);
        }

        function createSourceDistributionChart(sourcesData) {
            const ctx = document.getElementById('source-distribution-chart').getContext('2d');
            
            if (chartInstances.sourceDistribution) {
                chartInstances.sourceDistribution.destroy();
            }

            const sourceColors = {
                'PODCAST': '#f59e0b',
                'ONLINE_NEWS': '#3b82f6', 
                'REDDIT': '#ef4444'
            };

            chartInstances.sourceDistribution = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(sourcesData),
                    datasets: [{
                        label: 'Posts',
                        data: Object.values(sourcesData),
                        backgroundColor: Object.keys(sourcesData).map(key => sourceColors[key] || '#64748b'),
                        borderRadius: 8
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: { precision: 0 }
                        }
                    },
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
        }

        function createHourlyChart(hourlyData) {
            const ctx = document.getElementById('hourly-overview-chart').getContext('2d');
            
            if (chartInstances.hourly) {
                chartInstances.hourly.destroy();
            }

            // Convert to 24-hour format and sort
            const hourlyArray = Object.entries(hourlyData)
                .map(([hour, count]) => ({ hour: parseInt(hour), count }))
                .sort((a, b) => a.hour - b.hour);

            chartInstances.hourly = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: hourlyArray.map(item => `${item.hour}:00`),
                    datasets: [{
                        label: 'Posts per Hour',
                        data: hourlyArray.map(item => item.count),
                        backgroundColor: 'rgba(248, 163, 82, 0.3)',
                        borderColor: '#d94236',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: '#d94236',
                        pointBorderColor: '#fff',
                        pointRadius: 6,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { precision: 0 }
                        }
                    },
                    plugins: {
                        legend: { display: false }
                    }
                }
            });

            // Also create pattern chart
            createHourlyPatternChart(hourlyData);
        }

        function createHourlyPatternChart(hourlyData) {
            const ctx = document.getElementById('hourly-pattern-chart').getContext('2d');
            
            if (chartInstances.hourlyPattern) {
                chartInstances.hourlyPattern.destroy();
            }

            const hourlyArray = Object.entries(hourlyData)
                .map(([hour, count]) => ({ hour: parseInt(hour), count }))
                .sort((a, b) => a.hour - b.hour);

            chartInstances.hourlyPattern = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: hourlyArray.map(item => `${item.hour}:00`),
                    datasets: [{
                        label: 'Activity Level',
                        data: hourlyArray.map(item => item.count),
                        backgroundColor: hourlyArray.map(item => {
                            if (item.count > 80) return '#22c55e'; // High activity
                            if (item.count > 50) return '#f59e0b'; // Medium activity
                            return '#64748b'; // Low activity
                        }),
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { precision: 0 }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                afterLabel: function(context) {
                                    if (context.parsed.y > 80) return 'High Activity Period';
                                    if (context.parsed.y > 50) return 'Medium Activity Period';
                                    return 'Low Activity Period';
                                }
                            }
                        }
                    }
                }
            });
        }

        function createCountryChart(countriesData) {
            const ctx = document.getElementById('country-overview-chart').getContext('2d');
            
            if (chartInstances.countries) {
                chartInstances.countries.destroy();
            }

            if (Object.keys(countriesData).length === 0) {
                ctx.canvas.parentElement.innerHTML = '<div class="flex items-center justify-center h-full text-gray-500">No geographic data available</div>';
                return;
            }

            chartInstances.countries = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(countriesData),
                    datasets: [{
                        label: 'Posts',
                        data: Object.values(countriesData),
                        backgroundColor: ['#f59e0b', '#3b82f6', '#ef4444', '#8b5cf6', '#22c55e'],
                        borderRadius: 6
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: { precision: 0 }
                        }
                    },
                    plugins: {
                        legend: { display: false }
                    }
                }
            });

            // Also create geographic chart
            createGeographicChart(countriesData);
        }

        function createGeographicChart(countriesData) {
            const ctx = document.getElementById('geographic-chart').getContext('2d');
            
            if (chartInstances.geographic) {
                chartInstances.geographic.destroy();
            }

            if (Object.keys(countriesData).length === 0) {
                ctx.canvas.parentElement.innerHTML = '<div class="flex items-center justify-center h-full text-gray-500">Limited geographic data</div>';
                return;
            }

            chartInstances.geographic = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(countriesData),
                    datasets: [{
                        label: 'Posts by Country',
                        data: Object.values(countriesData),
                        backgroundColor: ['#f59e0b', '#3b82f6', '#ef4444', '#8b5cf6', '#22c55e', '#f97316', '#14b8a6'],
                        borderColor: '#ffffff',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                        },
                        title: {
                            display: true,
                            text: 'Global Reach Distribution'
                        }
                    }
                }
            });
        }
        
        function createAIKeywordsChart(aiKeywords) {
            const ctx = document.getElementById('ai-keywords-chart').getContext('2d');
            const sortedKeywords = Object.entries(aiKeywords).sort((a, b) => b[1] - a[1]).slice(0, 10);
            
            if (chartInstances.aiKeywords) {
                chartInstances.aiKeywords.destroy();
            }

            chartInstances.aiKeywords = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedKeywords.map(kw => kw[0]),
                    datasets: [{
                        label: 'Keyword Mentions',
                        data: sortedKeywords.map(kw => kw[1]),
                        backgroundColor: '#f8a352',
                        borderColor: '#d94236',
                        borderWidth: 2,
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }
        
        function updateTrendsTab(allAiKeywords, combinedHourly, firstArea) {
            document.getElementById('ai-total-mentions').textContent = formatNumber(Object.values(allAiKeywords).reduce((a, b) => a + b, 0));
            document.getElementById('trending-topics').textContent = Object.keys(allAiKeywords).length;

            const sortedKeywords = Object.entries(allAiKeywords).sort((a, b) => b[1] - a[1]);
            document.getElementById('dominant-category').textContent = sortedKeywords.length > 0 ? sortedKeywords[0][0] : 'N/A';

            const peakHours = Object.entries(combinedHourly).sort((a, b) => b[1] - a[1]).slice(0, 3);
            document.getElementById('peak-times-display').innerHTML = peakHours.map(([hour, count]) => `<div>${hour}:00 - ${count} posts</div>`).join('');
            
            // This part is a placeholder as weekly data isn't in the provided JSON
            document.getElementById('weekly-activity-display').innerHTML = 'Weekly data not available.'; 

            const topContent = firstArea?.top_content?.by_engagement?.slice(0, 3) || [];
            document.getElementById('top-content-display').innerHTML = topContent.map(item => 
                `<div class="border-b py-2">${item.title} (${item.engagement} engagement)</div>`
            ).join('');
        }
        
        function loadArticles() {
            document.getElementById('search-input').addEventListener('input', debounce(applyArticleFilters, 300));
            document.getElementById('source-filter').addEventListener('change', applyArticleFilters);
            document.getElementById('sentiment-filter').addEventListener('change', applyArticleFilters);
            document.getElementById('quality-filter').addEventListener('change', applyArticleFilters);
            
            applyArticleFilters();
        }

        function applyArticleFilters() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const sourceFilter = document.getElementById('source-filter').value;
            const sentimentFilter = document.getElementById('sentiment-filter').value;
            const qualityFilter = document.getElementById('quality-filter').value;

            filteredArticles = allArticles.filter(article => {
                const titleMatch = article.title.toLowerCase().includes(searchTerm);
                const summaryMatch = article.summary.toLowerCase().includes(searchTerm);
                const sourceMatch = sourceFilter === 'all' || article.journal === sourceFilter;
                
                // This is a placeholder for sentiment and quality as they are not in the article objects
                const sentimentMatch = sentimentFilter === 'all'; 
                const qualityMatch = qualityFilter === 'all';
                
                return (titleMatch || summaryMatch) && sourceMatch && sentimentMatch && qualityMatch;
            });

            renderArticles();
        }

        function renderArticles() {
            const container = document.getElementById('articles-container');
            container.innerHTML = '';
            document.getElementById('articles-showing').textContent = `Showing ${filteredArticles.length} articles`;

            if (filteredArticles.length === 0) {
                container.innerHTML = '<div class="text-center py-8 text-gray-500">No articles match your filters.</div>';
                return;
            }

            filteredArticles.forEach(article => {
                const articleEl = document.createElement('div');
                articleEl.className = 'border rounded-lg p-4 hover:shadow-lg transition-shadow cursor-pointer';
                articleEl.innerHTML = `
                    <h4 class="font-bold text-lg text-brand-red">${article.title}</h4>
                    <p class="text-sm text-gray-500">${article.date} - ${article.journal}</p>
                    <p class="mt-2 text-gray-700">${article.summary}</p>
                `;
                articleEl.addEventListener('click', () => showArticleModal(article));
                container.appendChild(articleEl);
            });
        }
        
        function showArticleModal(article) {
            const modal = document.getElementById('article-modal');
            const modalContent = document.getElementById('modal-content');
            
            modalContent.innerHTML = `
                <h3 class="font-bold text-2xl mb-2">${article.title}</h3>
                <p class="text-sm text-gray-600 mb-4">${article.date} | ${article.journal}</p>
                <p class="mb-4">${article.summary}</p>
                <h4 class="font-bold text-xl mb-2">Key Takeaways</h4>
                <ul class="list-disc pl-5 mb-4">
                    ${article.takeaways.map(t => `<li>${t}</li>`).join('')}
                </ul>
                <a href="${article.link}" target="_blank" class="text-brand-red hover:underline">Read Full Article</a>
            `;
            
            modal.classList.remove('hidden');
        }

        // Chart.js horizontalBar compatibility fix
        Chart.register({
            id: 'horizontalBarFix',
            beforeInit: function(chart) {
                if (chart.config.type === 'horizontalBar') {
                    chart.config.type = 'bar';
                    chart.config.options.indexAxis = 'y';
                }
            }
        });

        // Additional utility functions
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Enhanced search with debouncing
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('search-input');
            if (searchInput) {
                searchInput.addEventListener('input', debounce(applyArticleFilters, 300));
            }
        });

        // Keyboard navigation for modal
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                document.getElementById('article-modal').classList.add('hidden');
            }
        });

        // Click outside modal to close
        document.getElementById('article-modal').addEventListener('click', function(event) {
            if (event.target === this) {
                this.classList.add('hidden');
            }
        });

        // Smooth scrolling for internal links
        function scrollToSection(sectionId) {
            document.getElementById(sectionId).scrollIntoView({ 
                behavior: 'smooth' 
            });
        }

        // Export functionality
        function exportAnalytics() {
            if (pulsarAnalytics) {
                const dataStr = JSON.stringify(pulsarAnalytics, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `ai-analytics-export-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                URL.revokeObjectURL(url);
            }
        }

        // Auto-refresh functionality
        function setupAutoRefresh(intervalMinutes = 60) {
            setInterval(() => {
                console.log('Auto-refreshing dashboard data...');
                loadDashboardData();
            }, intervalMinutes * 60 * 1000);
        }

        // Performance monitoring
        function logPerformance(label, startTime) {
            const endTime = performance.now();
            console.log(`${label}: ${(endTime - startTime).toFixed(2)}ms`);
        }

        // Enhanced error handling
        window.addEventListener('error', function(event) {
            console.error('Dashboard error:', event.error);
            // Show user-friendly error message
            const errorContainer = document.createElement('div');
            errorContainer.className = 'fixed top-4 right-4 bg-red-500 text-white p-4 rounded-lg shadow-lg z-50';
            errorContainer.innerHTML = `
                <div class="flex items-center gap-2">
                    <span>‚ö†Ô∏è</span>
                    <span>Dashboard error occurred. Please refresh the page.</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-2 text-white hover:text-gray-200">√ó</button>
                </div>
            `;
            document.body.appendChild(errorContainer);
            
            // Auto-remove error after 5 seconds
            setTimeout(() => {
                if (errorContainer.parentElement) {
                    errorContainer.remove();
                }
            }, 5000);
        });

        // Initialize dashboard enhancements
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Enhanced AI Dashboard initializing...');
            
            // Add loading states to charts
            const loadingElements = document.querySelectorAll('[id$="-chart"]');
            loadingElements.forEach(el => {
                if (el.tagName === 'CANVAS') {
                    const ctx = el.getContext('2d');
                    ctx.fillStyle = '#f3f4f6';
                    ctx.fillRect(0, 0, el.width, el.height);
                    ctx.fillStyle = '#6b7280';
                    ctx.font = '16px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('Loading Analytics...', el.width / 2, el.height / 2);
                }
            });

            // Add loading animation to metric cards
            document.querySelectorAll('.metric-card').forEach(card => {
                card.style.opacity = '0.7';
                card.style.transform = 'scale(0.95)';
            });

            // Setup auto-refresh (commented out by default)
            // setupAutoRefresh(60); // Refresh every 60 minutes
            
            // Add version info to console
            console.log('üìä Dashboard Version: Enhanced Analytics v2.0');
            console.log('üîß Features: Social Listening, AI Trends, Real-time Filtering');
        });

        // Theme customization
        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('dashboard-theme', theme);
            
            // Update chart colors based on theme
            if (theme === 'dark') {
                Chart.defaults.color = '#ffffff';
                Chart.defaults.backgroundColor = '#374151';
            } else {
                Chart.defaults.color = '#374151';
                Chart.defaults.backgroundColor = '#ffffff';
            }
        }

        // Load saved theme
        const savedTheme = localStorage.getItem('dashboard-theme');
        if (savedTheme) {
            setTheme(savedTheme);
        }

        // Responsive chart handling
        function handleChartResize() {
            Object.values(chartInstances).forEach(chart => {
                if (chart && typeof chart.resize === 'function') {
                    try {
                        chart.resize();
                    } catch (e) {
                        console.warn('Chart resize error:', e);
                    }
                }
            });
        }

        window.addEventListener('resize', debounce(handleChartResize, 250));

        // Analytics interaction tracking
        function trackInteraction(action, label) {
            console.log(`User Interaction: ${action} - ${label}`);
            // Integration point for analytics services like Google Analytics
            if (typeof gtag !== 'undefined') {
                gtag('event', action, {
                    'event_category': 'Dashboard',
                    'event_label': label
                });
            }
        }

        // Enhanced accessibility features
        document.addEventListener('DOMContentLoaded', function() {
            // Add keyboard navigation for charts
            document.querySelectorAll('.chart-container').forEach(container => {
                container.setAttribute('tabindex', '0');
                container.setAttribute('role', 'img');
                container.setAttribute('aria-label', 'Interactive data visualization chart');
                
                // Add keyboard interaction
                container.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        trackInteraction('chart_keyboard_access', container.id);
                    }
                });
            });

            // Add ARIA labels to interactive elements
            document.querySelectorAll('.tab-button').forEach(button => {
                button.setAttribute('role', 'tab');
                button.setAttribute('aria-selected', button.classList.contains('active'));
            });

            // Add focus management
            const style = document.createElement('style');
            style.textContent = `
                .chart-container:focus {
                    outline: 3px solid #f8a352;
                    outline-offset: 2px;
                    border-radius: 8px;
                }
                
                .tab-button:focus {
                    outline: 3px solid #f8a352;
                    outline-offset: 2px;
                }
                
                .metric-card:focus {
                    outline: 3px solid #ffffff;
                    outline-offset: 2px;
                    transform: translateY(-5px) scale(1.02);
                }
                
                .analytics-card:focus-within {
                    box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1);
                    transform: translateY(-2px);
                }
            `;
            document.head.appendChild(style);
        });

        // Print functionality with chart preservation
        function printDashboard() {
            // Ensure all charts are rendered before printing
            const startTime = performance.now();
            
            Promise.all(Object.values(chartInstances).map(chart => {
                return new Promise(resolve => {
                    if (chart && chart.update) {
                        chart.update('none');
                    }
                    resolve();
                });
            })).then(() => {
                logPerformance('Chart preparation for print', startTime);
                window.print();
            });
        }

        // Add comprehensive print styles
        const printStyles = document.createElement('style');
        printStyles.textContent = `
            @media print {
                * {
                    -webkit-print-color-adjust: exact !important;
                    color-adjust: exact !important;
                }
                
                .tab-button, .no-print, #article-modal {
                    display: none !important;
                }
                
                .tab-content {
                    display: block !important;
                    page-break-inside: avoid;
                }
                
                .analytics-card {
                    break-inside: avoid;
                    margin-bottom: 1rem;
                    border: 1px solid #e5e7eb;
                }
                
                .chart-container {
                    height: 250px !important;
                }
                
                .metric-card {
                    border: 2px solid #f8a352 !important;
                    color: #000 !important;
                    background: linear-gradient(135deg, #f8a352 0%, #d94236 100%) !important;
                }
                
                .keyword-tag, .hashtag-tag {
                    border: 1px solid #d94236 !important;
                }
                
                h1, h2, h3 {
                    color: #d94236 !important;
                }
                
                @page {
                    margin: 1in;
                    size: letter;
                }
            }
        `;
        document.head.appendChild(printStyles);

        // Data refresh notification
        function showRefreshNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 transition-all duration-300';
            notification.innerHTML = `
                <div class="flex items-center gap-2">
                    <span>‚úÖ</span>
                    <span>${message}</span>
                </div>
            `;
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.style.transform = 'translateX(-50%) translateY(0)';
            }, 100);
            
            // Auto-remove after 3 seconds
            setTimeout(() => {
                notification.style.transform = 'translateX(-50%) translateY(-100px)';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Enhanced data loading with progress indication
        function loadDashboardData() {
            const startTime = performance.now();
            
            // Show loading indicators
            document.querySelectorAll('.metric-card').forEach(card => {
                card.style.opacity = '0.7';
                const valueElement = card.querySelector('div:first-child');
                if (valueElement) {
                    valueElement.innerHTML = '<div class="animate-pulse">Loading...</div>';
                }
            });
            
            fetch('data/latest_dashboard_data.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(data => {
                    dashboardData = data;
                    allArticles = data.articles || [];
                    pulsarAnalytics = data.pulsarAnalytics || {};
                    
                    // Restore metric card animations
                    document.querySelectorAll('.metric-card').forEach(card => {
                        card.style.opacity = '1';
                        card.style.transform = 'scale(1)';
                    });
                    
                    // Update basic info
                    updateBasicInfo(data);
                    
                    // Load analytics if available
                    if (pulsarAnalytics && Object.keys(pulsarAnalytics).length > 0) {
                        loadEnhancedAnalytics(pulsarAnalytics);
                        showRefreshNotification('Analytics data loaded successfully!');
                    } else {
                        console.warn('No Pulsar analytics data found');
                    }
                    
                    // Load articles
                    loadArticles();
                    
                    logPerformance('Dashboard data loading', startTime);
                    console.log('‚úÖ Dashboard loaded with enhanced analytics:', Object.keys(pulsarAnalytics));
                })
                .catch(error => {
                    console.error('Error loading dashboard data:', error);
                    
                    // Show error state
                    document.querySelectorAll('.metric-card').forEach(card => {
                        card.style.opacity = '0.5';
                        const valueElement = card.querySelector('div:first-child');
                        if (valueElement) {
                            valueElement.textContent = 'Error';
                        }
                    });
                    
                    // Show error notification
                    const errorNotification = document.createElement('div');
                    errorNotification.className = 'fixed top-4 right-4 bg-red-500 text-white p-4 rounded-lg shadow-lg z-50 max-w-md';
                    errorNotification.innerHTML = `
                        <div class="flex items-start gap-3">
                            <span class="text-xl">‚ö†Ô∏è</span>
                            <div class="flex-1">
                                <div class="font-semibold">Failed to Load Data</div>
                                <div class="text-sm mt-1">Please check if the data file exists and try refreshing the page.</div>
                                <button onclick="location.reload()" class="mt-2 bg-red-600 hover:bg-red-700 px-3 py-1 rounded text-sm">
                                    Refresh Page
                                </button>
                            </div>
                            <button onclick="this.closest('div.fixed').remove()" class="text-white hover:text-gray-200 ml-2">√ó</button>
                        </div>
                    `;
                    document.body.appendChild(errorNotification);
                });
        }

        // Data validation
        function validateAnalyticsData(analytics) {
            const required = ['overview', 'sentiment_distribution', 'source_distribution'];
            const missing = required.filter(key => !analytics[key]);
            
            if (missing.length > 0) {
                console.warn('Missing required analytics data:', missing);
                return false;
            }
            
            return true;
        }

        // Enhanced loading with retry mechanism
        let retryCount = 0;
        const maxRetries = 3;

        function loadDashboardDataWithRetry() {
            if (retryCount >= maxRetries) {
                console.error('Max retries reached. Please check your data source.');
                return;
            }
            
            retryCount++;
            console.log(`Loading attempt ${retryCount}/${maxRetries}`);
            
            loadDashboardData().catch(() => {
                setTimeout(() => {
                    loadDashboardDataWithRetry();
                }, 2000 * retryCount); // Exponential backoff
            });
        }

        // Initialize dashboard with retry mechanism
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Enhanced AI Dashboard initializing...');
            loadDashboardDataWithRetry();
        });

        // Performance optimizations
        const observerOptions = {
            root: null,
            rootMargin: '0px',
            threshold: 0.1
        };

        // Lazy load charts when they come into view
        const chartObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const chartId = entry.target.querySelector('canvas')?.id;
                    if (chartId && !chartInstances[chartId]) {
                        console.log('Lazy loading chart:', chartId);
                        // Chart will be created when data loads
                    }
                }
            });
        }, observerOptions);

        // Observe chart containers
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.chart-container').forEach(container => {
                chartObserver.observe(container);
            });
        });

        // Cleanup function for page unload
        window.addEventListener('beforeunload', function() {
            // Cleanup chart instances
            Object.values(chartInstances).forEach(chart => {
                if (chart && typeof chart.destroy === 'function') {
                    chart.destroy();
                }
            });
            
            // Cleanup observers
            if (chartObserver) {
                chartObserver.disconnect();
            }
        });

        // Final initialization message
        console.log('‚úÖ Enhanced AI Dashboard script fully loaded and ready!');
        console.log('üîß Features loaded: Auto-refresh, Export, Print, Accessibility, Error Handling');
        console.log('üìä Ready to display: 681 posts, 2,422 AI mentions, comprehensive analytics');

    </script>
</body>
</html>
