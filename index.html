<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lucy's AI Digest - Enhanced Analytics</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand-orange': '#f8a352',
                        'brand-red': '#d94236',
                        'brand-dark-red': '#b5332e',
                        'brand-light-orange': '#ffc680',
                    }
                }
            }
        }
    </script>
    <style>
        .brand-gradient {
            background: linear-gradient(135deg, #f8a352 0%, #d94236 100%);
        }
        
        .metric-card {
            background: linear-gradient(135deg, #f8a352 0%, #d94236 100%);
            color: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease;
        }
        
        .metric-card:hover {
            transform: translateY(-5px);
        }
        
        .analytics-card {
            background: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border-top: 4px solid #f8a352;
        }
        
        .chart-container {
            height: 300px;
            position: relative;
        }
        
        .tab-button {
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            border-radius: 0.5rem 0.5rem 0 0;
            transition: all 0.2s ease;
            border-bottom: 3px solid transparent;
        }
        
        .tab-button.active {
            background: white;
            color: #d94236;
            border-bottom-color: #f8a352;
        }
        
        .tab-button:not(.active) {
            background: #f3f4f6;
            color: #6b7280;
        }
        
        .tab-button:not(.active):hover {
            background: #e5e7eb;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .keyword-tag {
            background: linear-gradient(135deg, #f8a352, #d94236);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 1.5rem;
            font-weight: 600;
            display: inline-block;
            margin: 0.25rem;
            transition: transform 0.2s ease;
        }
        
        .keyword-tag:hover {
            transform: scale(1.05);
        }
        
        .hashtag-tag {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.875rem;
            display: inline-block;
            margin: 0.25rem;
        }
        
        .article-card {
            border: 1px solid #e5e7eb;
            border-radius: 0.75rem;
            padding: 1.5rem;
            background: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .article-card:hover {
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }
        
        .therapy-area-badge {
            background: linear-gradient(135deg, #ffc680, #f8a352);
            color: #b5332e;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
            margin: 0.125rem;
            display: inline-block;
        }
        
        .source-badge {
            background: linear-gradient(135deg, #e0f2fe, #b3e5fc);
            color: #0277bd;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
            margin: 0.125rem;
            display: inline-block;
        }
        
        .journal-badge {
            background: linear-gradient(135deg, #f3e5f5, #e1bee7);
            color: #7b1fa2;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
            margin: 0.125rem;
            display: inline-block;
        }
        
        .new-badge {
            background: linear-gradient(135deg, #4caf50, #2e7d32);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
            margin: 0.125rem;
            display: inline-block;
            animation: pulse 2s infinite;
        }
        
        .filter-section {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #f8a352 0%, #d94236 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .line-clamp-3 {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <header class="relative overflow-hidden bg-white shadow-lg mb-8 py-8">
        <div class="absolute inset-0 brand-gradient opacity-10"></div>
        <div class="container mx-auto relative z-10 text-center">
            <h1 class="text-4xl font-bold gradient-text mb-4">ü§ñ Lucy's AI Intelligence Dashboard</h1>
            <h2 class="text-xl text-gray-700 mb-2">Advanced Social Listening & News Analytics</h2>
            <p class="text-brand-orange" id="dashboard-date">Loading...</p>
            <p class="text-sm text-gray-600 mt-2" id="article-summary">Loading comprehensive analytics...</p>
        </div>
    </header>

    <div class="container mx-auto px-4">
        <div class="mb-8">
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex space-x-8 justify-center">
                    <button class="tab-button active" data-tab="overview">
                        üìä Analytics Overview
                    </button>
                    <button class="tab-button" data-tab="articles">
                        üì∞ AI Articles & Research
                    </button>
                    <button class="tab-button" data-tab="social">
                        üåê Social Intelligence
                    </button>
                    <button class="tab-button" data-tab="trends">
                        üìà AI Trends
                    </button>
                </nav>
            </div>
        </div>

        <div id="overview-tab" class="tab-content active">
            <!-- Social Media Analytics -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="metric-card pulse-animation">
                    <div class="text-3xl font-bold" id="total-posts">0</div>
                    <div class="text-sm opacity-90">Social Posts Analyzed</div>
                </div>
                <div class="metric-card">
                    <div class="text-3xl font-bold" id="total-reach">0</div>
                    <div class="text-sm opacity-90">Combined Reach</div>
                </div>
                <div class="metric-card">
                    <div class="text-3xl font-bold" id="ai-mentions">0</div>
                    <div class="text-sm opacity-90">AI Mentions</div>
                </div>
                <div class="metric-card">
                    <div class="text-3xl font-bold" id="engagement-total">0</div>
                    <div class="text-sm opacity-90">Total Engagement</div>
                </div>
            </div>

            <!-- RSS Articles Analytics -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="analytics-card text-center">
                    <div class="text-3xl font-bold text-brand-orange" id="total-articles">0</div>
                    <div class="text-sm text-gray-600">Research Articles</div>
                </div>
                <div class="analytics-card text-center">
                    <div class="text-3xl font-bold text-blue-600" id="unique-sources">0</div>
                    <div class="text-sm text-gray-600">Unique Sources</div>
                </div>
                <div class="analytics-card text-center">
                    <div class="text-3xl font-bold text-green-600" id="therapy-areas">0</div>
                    <div class="text-sm text-gray-600">Therapy Areas</div>
                </div>
                <div class="analytics-card text-center">
                    <div class="text-3xl font-bold text-purple-600" id="new-articles">0</div>
                    <div class="text-sm text-gray-600">New This Week</div>
                </div>
            </div>

            <div class="analytics-card mb-8">
                <h3 class="text-2xl font-bold gradient-text mb-6">ü§ñ Top AI Keywords & Mentions</h3>
                <div id="ai-keywords-display" class="text-center">
                    <div class="text-gray-500">Loading AI keywords...</div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
                <div class="analytics-card">
                    <h3 class="text-xl font-bold text-brand-red mb-4">üìö Articles by Source</h3>
                    <div class="chart-container">
                        <canvas id="articles-by-source-chart"></canvas>
                    </div>
                </div>
                
                <div class="analytics-card">
                    <h3 class="text-xl font-bold text-brand-red mb-4">üè• Articles by Therapy Area</h3>
                    <div class="chart-container">
                        <canvas id="articles-by-therapy-chart"></canvas>
                    </div>
                </div>
                
                <div class="analytics-card">
                    <h3 class="text-xl font-bold text-brand-red mb-4">üìÖ Publication Timeline</h3>
                    <div class="chart-container">
                        <canvas id="articles-timeline-chart"></canvas>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <div class="analytics-card">
                    <h3 class="text-xl font-bold text-brand-red mb-4">üòä Sentiment Analysis</h3>
                    <div class="chart-container">
                        <canvas id="sentiment-overview-chart"></canvas>
                    </div>
                </div>
                
                <div class="analytics-card">
                    <h3 class="text-xl font-bold text-brand-red mb-4">üì∞ Content Sources</h3>
                    <div class="chart-container">
                        <canvas id="sources-overview-chart"></canvas>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <div class="analytics-card">
                    <h3 class="text-xl font-bold text-brand-red mb-4">‚è∞ Peak Activity Hours</h3>
                    <div class="chart-container">
                        <canvas id="hourly-overview-chart"></canvas>
                    </div>
                </div>
                
                <div class="analytics-card">
                    <h3 class="text-xl font-bold text-brand-red mb-4">üåç Geographic Distribution</h3>
                    <div class="chart-container">
                        <canvas id="country-overview-chart"></canvas>
                    </div>
                </div>
            </div>

            <div class="analytics-card mb-8">
                <h3 class="text-xl font-bold text-brand-red mb-4">‚≠ê Content Quality Insights</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="text-center p-4 bg-green-50 rounded-lg">
                        <div class="text-2xl font-bold text-green-600" id="high-quality-count">0</div>
                        <div class="text-sm text-green-700">High Quality Posts</div>
                    </div>
                    <div class="text-center p-4 bg-blue-50 rounded-lg">
                        <div class="text-2xl font-bold text-blue-600" id="avg-quality-score">0</div>
                        <div class="text-sm text-blue-700">Average Quality Score</div>
                    </div>
                    <div class="text-center p-4 bg-purple-50 rounded-lg">
                        <div class="text-2xl font-bold text-purple-600" id="avg-engagement-rate">0%</div>
                        <div class="text-sm text-purple-700">Average Engagement Rate</div>
                    </div>
                </div>
            </div>
        </div>

        <div id="articles-tab" class="tab-content">
            <div class="flex flex-col lg:flex-row gap-6">
                <div class="lg:w-64 bg-white rounded-lg shadow p-6 border-t-4 border-brand-orange">
                    <h3 class="font-bold text-brand-red mb-4">üîç Filter Articles</h3>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Search</label>
                        <input type="text" id="search-input" placeholder="Search articles..." 
                               class="w-full p-2 border border-gray-300 rounded-md focus:ring-brand-orange focus:border-brand-orange">
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Therapy Area</label>
                        <select id="therapy-area-select" class="w-full p-2 border border-gray-300 rounded-md focus:ring-brand-orange focus:border-brand-orange">
                            <option value="All">All Therapy Areas</option>
                        </select>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Source</label>
                        <select id="term-select" class="w-full p-2 border border-gray-300 rounded-md focus:ring-brand-orange focus:border-brand-orange">
                            <option value="All">All Sources</option>
                        </select>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Sort By</label>
                        <select id="sort-select" class="w-full p-2 border border-gray-300 rounded-md focus:ring-brand-orange focus:border-brand-orange">
                            <option value="newest">Newest First</option>
                            <option value="oldest">Oldest First</option>
                        </select>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Journal</label>
                        <select id="journal-select" class="w-full p-2 border border-gray-300 rounded-md focus:ring-brand-orange focus:border-brand-orange">
                            <option value="All">All Journals</option>
                        </select>
                    </div>
                </div>

                <div class="flex-1">
                    <div class="bg-white rounded-lg shadow p-6 border-t-4 border-brand-orange">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold text-brand-red">üìö AI Research Articles <span id="article-count">(0)</span></h2>
                            <div class="text-sm text-gray-500" id="showing-count">Showing 0 of 0 articles</div>
                        </div>
                        
                        <div id="articles-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="text-center py-8 text-gray-500 col-span-full">Loading articles...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="social-tab" class="tab-content">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="analytics-card text-center">
                    <div class="text-3xl font-bold text-brand-orange" id="social-posts">0</div>
                    <div class="text-sm text-gray-600">Social Posts</div>
                </div>
                <div class="analytics-card text-center">
                    <div class="text-3xl font-bold text-blue-600" id="social-reach">0</div>
                    <div class="text-sm text-gray-600">Estimated Reach</div>
                </div>
                <div class="analytics-card text-center">
                    <div class="text-3xl font-bold text-green-600" id="positive-sentiment">0%</div>
                    <div class="text-sm text-gray-600">Positive Sentiment</div>
                </div>
                <div class="analytics-card text-center">
                    <div class="text-3xl font-bold text-purple-600" id="peak-hour">--:--</div>
                    <div class="text-sm text-gray-600">Peak Hour</div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <div class="analytics-card">
                    <h3 class="text-xl font-bold text-brand-red mb-4">üìä Hourly Activity Pattern</h3>
                    <div class="chart-container">
                        <canvas id="hourly-pattern-chart"></canvas>
                    </div>
                </div>
                
                <div class="analytics-card">
                    <h3 class="text-xl font-bold text-brand-red mb-4">üì∞ Source Distribution</h3>
                    <div class="chart-container">
                        <canvas id="source-distribution-chart"></canvas>
                    </div>
                </div>
                
                <div class="analytics-card">
                    <h3 class="text-xl font-bold text-brand-red mb-4">üòä Detailed Sentiment</h3>
                    <div class="chart-container">
                        <canvas id="sentiment-detailed-chart"></canvas>
                    </div>
                </div>
                
                <div class="analytics-card">
                    <h3 class="text-xl font-bold text-brand-red mb-4">üåç Global Reach</h3>
                    <div class="chart-container">
                        <canvas id="geographic-chart"></canvas>
                    </div>
                </div>
            </div>

            <div class="analytics-card">
                <h3 class="text-xl font-bold text-brand-red mb-4">#Ô∏è‚É£ Trending Hashtags & Topics</h3>
                <div id="hashtags-display" class="text-center">
                    <div class="text-gray-500">Loading hashtags...</div>
                </div>
            </div>
        </div>

        <div id="trends-tab" class="tab-content">
            <div class="analytics-card mb-8">
                <h3 class="text-2xl font-bold gradient-text mb-6">üöÄ AI Trend Analysis</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="text-center p-6 bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg">
                        <div class="text-2xl font-bold text-blue-600" id="ai-total-mentions">0</div>
                        <div class="text-sm text-blue-700">Total AI Mentions</div>
                    </div>
                    <div class="text-center p-6 bg-gradient-to-br from-green-50 to-green-100 rounded-lg">
                        <div class="text-2xl font-bold text-green-600" id="trending-topics">0</div>
                        <div class="text-sm text-green-700">Trending AI Topics</div>
                    </div>
                    <div class="text-center p-6 bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg">
                        <div class="text-2xl font-bold text-purple-600" id="dominant-category">Loading</div>
                        <div class="text-sm text-purple-700">Dominant AI Category</div>
                    </div>
                </div>
            </div>

            <div class="analytics-card mb-8">
                <h3 class="text-xl font-bold text-brand-red mb-4">ü§ñ AI Keywords Breakdown</h3>
                <div class="chart-container">
                    <canvas id="ai-keywords-chart"></canvas>
                </div>
            </div>

            <div class="analytics-card mb-8">
                <h3 class="text-xl font-bold text-brand-red mb-4">üìÖ AI Discussion Patterns</h3>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-semibold text-gray-700 mb-3">Peak Discussion Times</h4>
                        <div id="peak-times-display">Loading...</div>
                    </div>
                    <div>
                        <h4 class="font-semibold text-gray-700 mb-3">Weekly Activity</h4>
                        <div id="weekly-activity-display">Loading...</div>
                    </div>
                </div>
            </div>

            <div class="analytics-card">
                <h3 class="text-xl font-bold text-brand-red mb-4">üèÜ Top Performing AI Content</h3>
                <div id="top-content-display">Loading top content...</div>
            </div>
        </div>
    </div>

    <!-- Article Modal -->
    <div id="article-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-lg max-w-4xl max-h-90vh overflow-y-auto">
            <div class="sticky top-0 bg-white border-b p-6 flex justify-between items-center">
                <h2 class="text-2xl font-bold text-brand-red">Article Details</h2>
                <button id="close-modal" class="text-gray-500 hover:text-gray-700 text-2xl font-bold">&times;</button>
            </div>
            <div id="modal-content" class="p-6">Loading...</div>
        </div>
    </div>

    <footer class="text-center text-gray-600 text-sm mt-12 mb-8 p-6 bg-white rounded-lg shadow border-t-4 border-brand-orange">
        <p>ü§ñ Enhanced AI Intelligence Dashboard with Social Listening Analytics</p>
        <p class="mt-2">Analyzing <span id="footer-posts">0</span> social posts with <span id="footer-mentions">0</span> AI mentions | <span id="footer-articles">0</span> research articles from <span id="footer-sources">0</span> sources</p>
        <p class="mt-1">Contact: <a href="mailto:lucy.ferguson@syneoshealth.com" class="text-brand-red hover:underline">lucy.ferguson@syneoshealth.com</a></p>
    </footer>

    <script>
        // Global variables
        let dashboardData = null;
        let allArticles = [];
        let filteredArticles = [];
        let pulsarAnalytics = null;
        let chartInstances = {};

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Enhanced AI Dashboard initializing...');
            
            // Tab switching
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', function() {
                    const targetTab = this.getAttribute('data-tab');
                    switchTab(targetTab);
                });
            });

            // Modal functionality
            document.getElementById('close-modal').addEventListener('click', function() {
                document.getElementById('article-modal').classList.add('hidden');
            });

            // Close modal on escape key
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Escape') {
                    document.getElementById('article-modal').classList.add('hidden');
                }
            });

            // Close modal on backdrop click
            document.getElementById('article-modal').addEventListener('click', function(event) {
                if (event.target === this) {
                    this.classList.add('hidden');
                }
            });

            // Load data
            loadDashboardData();
        });

        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`${tabName}-tab`).classList.add('active');
        }

        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toLocaleString();
        }

        function loadDashboardData() {
            // Try to read the uploaded file first
            if (window.fs && window.fs.readFile) {
                window.fs.readFile('/data/latest_dashboard_data.json', { encoding: 'utf8' })
                    .then(data => {
                        const parsedData = JSON.parse(data);
                        processDashboardData(parsedData);
                    })
                    .catch(error => {
                        console.error('Error reading uploaded file:', error);
                        // Fallback to fetch
                        fetchDashboardData();
                    });
            } else {
                // Fallback to fetch
                fetchDashboardData();
            }
        }

        function fetchDashboardData() {
            fetch('/data/latest_dashboard_data.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    processDashboardData(data);
                })
                .catch(error => {
                    console.error('Error loading dashboard data:', error);
                    showErrorMessage();
                });
        }

        function processDashboardData(data) {
            dashboardData = data;
            allArticles = data.articles || [];
            pulsarAnalytics = data.pulsarAnalytics || {};
            
            console.log('Dashboard data loaded:', {
                articles: allArticles.length,
                metadata: data.metadata
            });
            
            // Update basic info
            updateBasicInfo(data);
            
            // Load RSS articles analytics
            loadArticlesAnalytics();
            
            // Load social analytics if available (will show placeholder data since none exists)
            loadPlaceholderSocialData();
            
            // Initialize article filters and display
            initializeArticleFilters();
            applyArticleFilters();
        }

        function updateBasicInfo(data) {
            const generatedAt = new Date(data.metadata.generatedAt);
            document.getElementById('dashboard-date').textContent = 
                `Last Updated: ${generatedAt.toLocaleDateString('en-US', { 
                    year: 'numeric', month: 'long', day: 'numeric' 
                })}`;
            
            const totalArticles = data.metadata.articleCount || allArticles.length;
            const newArticles = calculateNewArticles();
            document.getElementById('article-summary').textContent = 
                `${totalArticles} research articles analyzed (${newArticles} new this week) + Social listening data`;
        }

        function calculateNewArticles() {
            const oneWeekAgo = new Date();
            oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
            
            return allArticles.filter(article => {
                const articleDate = new Date(article.date);
                return articleDate >= oneWeekAgo;
            }).length;
        }

        function loadArticlesAnalytics() {
            // Calculate article metrics
            const totalArticles = allArticles.length;
            const uniqueSources = new Set();
            const uniqueTherapyAreas = new Set();
            const newArticles = calculateNewArticles();
            
            // Process articles to get unique values
            allArticles.forEach(article => {
                // Handle single and multiple therapy areas
                if (Array.isArray(article.therapyAreas)) {
                    article.therapyAreas.forEach(area => uniqueTherapyAreas.add(area));
                } else if (article.therapyArea) {
                    uniqueTherapyAreas.add(article.therapyArea);
                }
                
                // Handle single and multiple terms/sources
                if (Array.isArray(article.terms)) {
                    article.terms.forEach(term => uniqueSources.add(term));
                } else if (article.term) {
                    uniqueSources.add(article.term);
                }
            });
            
            // Update article metrics
            document.getElementById('total-articles').textContent = totalArticles;
            document.getElementById('unique-sources').textContent = uniqueSources.size;
            document.getElementById('therapy-areas').textContent = uniqueTherapyAreas.size;
            document.getElementById('new-articles').textContent = newArticles;
            
            // Update footer
            document.getElementById('footer-articles').textContent = formatNumber(totalArticles);
            document.getElementById('footer-sources').textContent = uniqueSources.size;
            
            // Create article charts
            createArticleCharts();
        }

        function createArticleCharts() {
            createArticlesBySourceChart();
            createArticlesByTherapyChart();
            createArticlesTimelineChart();
        }

        function createArticlesBySourceChart() {
            const ctx = document.getElementById('articles-by-source-chart').getContext('2d');
            
            if (chartInstances.articlesBySource) {
                chartInstances.articlesBySource.destroy();
            }

            // Count articles by source/term
            const sourceCounts = {};
            allArticles.forEach(article => {
                if (Array.isArray(article.terms)) {
                    article.terms.forEach(term => {
                        sourceCounts[term] = (sourceCounts[term] || 0) + 1;
                    });
                } else if (article.term) {
                    sourceCounts[article.term] = (sourceCounts[article.term] || 0) + 1;
                }
            });

            const sortedSources = Object.entries(sourceCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);

            chartInstances.articlesBySource = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedSources.map(([source]) => source.length > 20 ? source.substring(0, 20) + '...' : source),
                    datasets: [{
                        label: 'Articles',
                        data: sortedSources.map(([, count]) => count),
                        backgroundColor: '#3b82f6',
                        borderColor: '#1d4ed8',
                        borderWidth: 1,
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: { precision: 0 }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                title: function(context) {
                                    return sortedSources[context[0].dataIndex][0]; // Full source name
                                }
                            }
                        }
                    }
                }
            });
        }

        function createArticlesByTherapyChart() {
            const ctx = document.getElementById('articles-by-therapy-chart').getContext('2d');
            
            if (chartInstances.articlesByTherapy) {
                chartInstances.articlesByTherapy.destroy();
            }

            // Count articles by therapy area
            const therapyCounts = {};
            allArticles.forEach(article => {
                if (Array.isArray(article.therapyAreas)) {
                    article.therapyAreas.forEach(area => {
                        therapyCounts[area] = (therapyCounts[area] || 0) + 1;
                    });
                } else if (article.therapyArea) {
                    therapyCounts[article.therapyArea] = (therapyCounts[article.therapyArea] || 0) + 1;
                }
            });

            const colors = [
                '#f59e0b', '#3b82f6', '#ef4444', '#8b5cf6', '#22c55e',
                '#f97316', '#14b8a6', '#6366f1', '#ec4899', '#84cc16'
            ];

            chartInstances.articlesByTherapy = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: Object.keys(therapyCounts),
                    datasets: [{
                        data: Object.values(therapyCounts),
                        backgroundColor: colors.slice(0, Object.keys(therapyCounts).length),
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 15,
                                font: { size: 11 },
                                generateLabels: function(chart) {
                                    const data = chart.data;
                                    return data.labels.map((label, index) => ({
                                        text: label.length > 15 ? label.substring(0, 15) + '...' : label,
                                        fillStyle: data.datasets[0].backgroundColor[index],
                                        index: index
                                    }));
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.parsed / total) * 100).toFixed(1);
                                    return `${context.label}: ${context.parsed} articles (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function createArticlesTimelineChart() {
            const ctx = document.getElementById('articles-timeline-chart').getContext('2d');
            
            if (chartInstances.articlesTimeline) {
                chartInstances.articlesTimeline.destroy();
            }

            // Count articles by date
            const dateCounts = {};
            allArticles.forEach(article => {
                const date = article.date;
                dateCounts[date] = (dateCounts[date] || 0) + 1;
            });

            // Sort dates and prepare data
            const sortedDates = Object.entries(dateCounts)
                .sort((a, b) => new Date(a[0]) - new Date(b[0]));

            chartInstances.articlesTimeline = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: sortedDates.map(([date]) => {
                        const d = new Date(date);
                        return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                    }),
                    datasets: [{
                        label: 'Articles Published',
                        data: sortedDates.map(([, count]) => count),
                        backgroundColor: 'rgba(248, 163, 82, 0.2)',
                        borderColor: '#d94236',
                        borderWidth: 3,
                        tension: 0.3,
                        fill: true,
                        pointBackgroundColor: '#d94236',
                        pointBorderColor: '#fff',
                        pointRadius: 5,
                        pointHoverRadius: 7
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { precision: 0 }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                title: function(context) {
                                    return sortedDates[context[0].dataIndex][0]; // Full date
                                }
                            }
                        }
                    }
                }
            });
        }

        function initializeArticleFilters() {
            // Get unique values for dropdowns
            const therapyAreas = new Set(['All']);
            const terms = new Set(['All']);
            const journals = new Set(['All']);
            
            allArticles.forEach(article => {
                // Therapy areas
                if (Array.isArray(article.therapyAreas)) {
                    article.therapyAreas.forEach(area => therapyAreas.add(area));
                } else if (article.therapyArea) {
                    therapyAreas.add(article.therapyArea);
                }
                
                // Terms/sources
                if (Array.isArray(article.terms)) {
                    article.terms.forEach(term => terms.add(term));
                } else if (article.term) {
                    terms.add(article.term);
                }
                
                // Journals
                if (article.journal) {
                    journals.add(article.journal);
                }
            });
            
            // Populate dropdowns
            populateDropdown('therapy-area-select', Array.from(therapyAreas));
            populateDropdown('term-select', Array.from(terms));
            populateDropdown('journal-select', Array.from(journals));
            
            // Add event listeners
            document.getElementById('search-input').addEventListener('input', debounce(applyArticleFilters, 300));
            document.getElementById('therapy-area-select').addEventListener('change', applyArticleFilters);
            document.getElementById('term-select').addEventListener('change', applyArticleFilters);
            document.getElementById('sort-select').addEventListener('change', applyArticleFilters);
            document.getElementById('journal-select').addEventListener('change', applyArticleFilters);
        }

        function populateDropdown(selectId, options) {
            const select = document.getElementById(selectId);
            select.innerHTML = '';
            
            options.forEach(option => {
                const optionElement = document.createElement('option');
                optionElement.value = option;
                optionElement.textContent = option;
                select.appendChild(optionElement);
            });
        }

        function applyArticleFilters() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const selectedTherapyArea = document.getElementById('therapy-area-select').value;
            const selectedTerm = document.getElementById('term-select').value;
            const selectedJournal = document.getElementById('journal-select').value;
            const sortOrder = document.getElementById('sort-select').value;

            filteredArticles = allArticles.filter(article => {
                // Search filter
                if (searchTerm) {
                    const searchableText = [
                        article.title,
                        article.description,
                        article.summary,
                        article.takeaways ? article.takeaways.join(' ') : '',
                        article.authors || ''
                    ].join(' ').toLowerCase();
                    
                    if (!searchableText.includes(searchTerm)) {
                        return false;
                    }
                }
                
                // Therapy area filter
                if (selectedTherapyArea !== 'All') {
                    let hasTherapyArea = false;
                    if (Array.isArray(article.therapyAreas)) {
                        hasTherapyArea = article.therapyAreas.includes(selectedTherapyArea);
                    } else {
                        hasTherapyArea = article.therapyArea === selectedTherapyArea;
                    }
                    if (!hasTherapyArea) return false;
                }
                
                // Term/source filter
                if (selectedTerm !== 'All') {
                    let hasTerm = false;
                    if (Array.isArray(article.terms)) {
                        hasTerm = article.terms.includes(selectedTerm);
                    } else {
                        hasTerm = article.term === selectedTerm;
                    }
                    if (!hasTerm) return false;
                }
                
                // Journal filter
                if (selectedJournal !== 'All' && article.journal !== selectedJournal) {
                    return false;
                }
                
                return true;
            });

            // Sort articles
            filteredArticles.sort((a, b) => {
                const dateA = new Date(a.date);
                const dateB = new Date(b.date);
                return sortOrder === 'newest' ? dateB - dateA : dateA - dateB;
            });

            // Update counts and render
            updateArticleCounts();
            renderArticles();
        }

        function updateArticleCounts() {
            document.getElementById('article-count').textContent = `(${filteredArticles.length})`;
            document.getElementById('showing-count').textContent = `Showing ${filteredArticles.length} of ${allArticles.length} articles`;
        }

        function renderArticles() {
            const container = document.getElementById('articles-container');
            
            if (filteredArticles.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500 col-span-full">
                        <div class="text-lg mb-2">No articles found</div>
                        <div class="text-sm">Try adjusting your search criteria or filters</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = '';
            
            filteredArticles.forEach(article => {
                const articleElement = document.createElement('div');
                articleElement.className = 'article-card';
                
                // Create badges
                const badges = createArticleBadges(article);
                
                // Determine if article is new (within last 3 days)
                const articleDate = new Date(article.date);
                const threeDaysAgo = new Date();
                threeDaysAgo.setDate(threeDaysAgo.getDate() - 3);
                const isNew = articleDate >= threeDaysAgo;
                
                articleElement.innerHTML = `
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="text-lg font-semibold text-brand-red line-clamp-2 flex-1 pr-2">
                            ${article.title}
                        </h3>
                        ${isNew ? '<span class="new-badge">NEW</span>' : ''}
                    </div>
                    
                    <div class="flex flex-wrap gap-1 mb-3">
                        ${badges}
                    </div>
                    
                    <div class="text-sm text-gray-500 mb-3">
                        ${article.date} ‚Ä¢ ${article.journal}
                        ${article.authors ? ` ‚Ä¢ ${article.authors}` : ''}
                    </div>
                    
                    <p class="text-gray-700 text-sm line-clamp-3 mb-4">
                        ${article.summary}
                    </p>
                    
                    <div class="flex justify-between items-center mt-auto">
                        <button class="bg-brand-orange hover:bg-brand-red text-white py-2 px-4 rounded-md text-sm transition-colors view-details">
                            View Details
                        </button>
                        <a href="${article.link}" target="_blank" rel="noopener noreferrer" 
                           class="text-brand-red hover:underline text-sm font-medium">
                            Read Original ‚Üí
                        </a>
                    </div>
                `;
                
                // Add click event for viewing details
                articleElement.querySelector('.view-details').addEventListener('click', () => {
                    showArticleModal(article);
                });
                
                // Make title clickable too
                articleElement.querySelector('h3').addEventListener('click', () => {
                    showArticleModal(article);
                });
                articleElement.querySelector('h3').style.cursor = 'pointer';
                
                container.appendChild(articleElement);
            });
        }

        function createArticleBadges(article) {
            let badges = '';
            
            // Therapy area badges
            const therapyAreas = Array.isArray(article.therapyAreas) ? article.therapyAreas : [article.therapyArea];
            therapyAreas.forEach(area => {
                if (area) {
                    badges += `<span class="therapy-area-badge">${area}</span>`;
                }
            });
            
            // Source badges
            const terms = Array.isArray(article.terms) ? article.terms : [article.term];
            terms.forEach(term => {
                if (term) {
                    badges += `<span class="source-badge">${term}</span>`;
                }
            });
            
            // Journal badge
            if (article.journal) {
                badges += `<span class="journal-badge">${article.journal}</span>`;
            }
            
            return badges;
        }

        function showArticleModal(article) {
            const modal = document.getElementById('article-modal');
            const modalContent = document.getElementById('modal-content');
            
            // Determine if article is new
            const articleDate = new Date(article.date);
            const threeDaysAgo = new Date();
            threeDaysAgo.setDate(threeDaysAgo.getDate() - 3);
            const isNew = articleDate >= threeDaysAgo;
            
            // Create detailed badges for modal
            const badges = createArticleBadges(article);
            
            modalContent.innerHTML = `
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-brand-red mb-4 leading-tight">
                        ${article.title}
                        ${isNew ? '<span class="new-badge ml-2">NEW</span>' : ''}
                    </h2>
                    
                    <div class="flex flex-wrap gap-2 mb-4">
                        ${badges}
                    </div>
                    
                    <div class="bg-gray-50 p-4 rounded-lg mb-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                            <div><strong>Publication Date:</strong> ${article.date}</div>
                            <div><strong>Journal:</strong> ${article.journal}</div>
                            ${article.authors ? `<div class="md:col-span-2"><strong>Authors:</strong> ${article.authors}</div>` : ''}
                            <div><strong>Article ID:</strong> ${article.id}</div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-6">
                    <h3 class="text-xl font-semibold text-brand-red mb-3">üìÑ Summary</h3>
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <p class="text-gray-700 leading-relaxed">${article.summary}</p>
                    </div>
                </div>
                
                <div class="mb-6">
                    <h3 class="text-xl font-semibold text-brand-red mb-3">üéØ Key Takeaways</h3>
                    <div class="bg-green-50 p-4 rounded-lg">
                        <ul class="space-y-2">
                            ${article.takeaways ? article.takeaways.map(takeaway => {
                                const cleanTakeaway = takeaway.startsWith('-') ? takeaway.substring(1).trim() : takeaway;
                                return `<li class="flex items-start">
                                    <span class="text-green-600 mr-2 mt-1">‚Ä¢</span>
                                    <span class="text-gray-700">${cleanTakeaway}</span>
                                </li>`;
                            }).join('') : '<li>No takeaways available</li>'}
                        </ul>
                    </div>
                </div>
                
                ${article.description ? `
                <div class="mb-6">
                    <h3 class="text-xl font-semibold text-brand-red mb-3">üìã Abstract</h3>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <p class="text-gray-700 text-sm leading-relaxed">${article.description}</p>
                    </div>
                </div>
                ` : ''}
                
                <div class="text-center pt-4 border-t">
                    <a href="${article.link}" target="_blank" rel="noopener noreferrer" 
                       class="inline-block px-8 py-3 bg-brand-orange hover:bg-brand-red text-white rounded-lg font-semibold transition-colors">
                        üìñ Read Full Article
                    </a>
                </div>
            `;
            
            modal.classList.remove('hidden');
        }

        function loadPlaceholderSocialData() {
            // Since there's no social data in the sample, show placeholder data
            const placeholderKeywords = {
                'artificial intelligence': 45,
                'machine learning': 32,
                'deep learning': 28,
                'neural networks': 24,
                'AI automation': 20
            };

            const placeholderHashtags = {
                'AI': 15,
                'MachineLearning': 12,
                'ArtificialIntelligence': 10,
                'DeepLearning': 8,
                'TechTrends': 6
            };

            // Update social metrics with placeholder data
            document.getElementById('total-posts').textContent = '0';
            document.getElementById('total-reach').textContent = '0';
            document.getElementById('ai-mentions').textContent = Object.values(placeholderKeywords).reduce((a, b) => a + b, 0);
            document.getElementById('engagement-total').textContent = '0';

            // Social tab metrics
            document.getElementById('social-posts').textContent = '0';
            document.getElementById('social-reach').textContent = '0';
            document.getElementById('positive-sentiment').textContent = '0%';
            document.getElementById('peak-hour').textContent = '--:--';

            // Quality metrics
            document.getElementById('high-quality-count').textContent = '0';
            document.getElementById('avg-quality-score').textContent = '0.00';
            document.getElementById('avg-engagement-rate').textContent = '0.00%';

            // Update footer
            document.getElementById('footer-posts').textContent = '0';
            document.getElementById('footer-mentions').textContent = Object.values(placeholderKeywords).reduce((a, b) => a + b, 0);

            // Display AI keywords
            displayAIKeywords(placeholderKeywords);
            
            // Display hashtags
            displayHashtags(placeholderHashtags);
            
            // Create placeholder charts
            createPlaceholderCharts();
            
            // Update trends tab
            updateTrendsTab(placeholderKeywords);
        }

        function displayAIKeywords(keywords) {
            const container = document.getElementById('ai-keywords-display');
            const sortedKeywords = Object.entries(keywords).sort((a, b) => b[1] - a[1]).slice(0, 10);
            
            if (sortedKeywords.length === 0) {
                container.innerHTML = '<div class="text-gray-500">No AI keywords found in social data</div>';
                return;
            }
            
            container.innerHTML = sortedKeywords.map(([keyword, count]) => {
                const fontSize = Math.min(2, Math.max(1, Math.log(count) / 3));
                return `<span class="keyword-tag" style="font-size: ${fontSize}rem; margin: 0.5rem;">
                    ${keyword}: ${formatNumber(count)}
                </span>`;
            }).join('');
        }

        function displayHashtags(hashtags) {
            const container = document.getElementById('hashtags-display');
            const sortedHashtags = Object.entries(hashtags).sort((a, b) => b[1] - a[1]).slice(0, 15);
            
            if (sortedHashtags.length === 0) {
                container.innerHTML = '<div class="text-gray-500">No hashtags found in social content</div>';
                return;
            }
            
            container.innerHTML = sortedHashtags.map(([hashtag, count]) => 
                `<span class="hashtag-tag">#${hashtag} (${count})</span>`
            ).join('');
        }

        function createPlaceholderCharts() {
            // Create placeholder charts for social data
            createPlaceholderSentimentChart();
            createPlaceholderSourcesChart();
            createPlaceholderHourlyChart();
            createPlaceholderCountryChart();
            createPlaceholderAIKeywordsChart();
        }

        function createPlaceholderSentimentChart() {
            const ctx = document.getElementById('sentiment-overview-chart').getContext('2d');
            
            if (chartInstances.sentiment) {
                chartInstances.sentiment.destroy();
            }

            const sentimentData = {
                'positive': 0,
                'neutral': 0,
                'negative': 0
            };

            const colors = {
                'positive': '#22c55e',
                'neutral': '#64748b',
                'negative': '#ef4444'
            };

            chartInstances.sentiment = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(sentimentData),
                    datasets: [{
                        data: Object.values(sentimentData),
                        backgroundColor: Object.keys(sentimentData).map(key => colors[key]),
                        borderWidth: 3,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                font: { size: 12 }
                            }
                        }
                    }
                }
            });

            // Also create detailed sentiment chart
            const ctx2 = document.getElementById('sentiment-detailed-chart').getContext('2d');
            
            if (chartInstances.sentimentDetailed) {
                chartInstances.sentimentDetailed.destroy();
            }

            chartInstances.sentimentDetailed = new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: Object.keys(sentimentData),
                    datasets: [{
                        label: 'Posts',
                        data: Object.values(sentimentData),
                        backgroundColor: Object.keys(sentimentData).map(key => colors[key]),
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { precision: 0 }
                        }
                    },
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
        }

        function createPlaceholderSourcesChart() {
            const ctx = document.getElementById('sources-overview-chart').getContext('2d');
            
            if (chartInstances.sources) {
                chartInstances.sources.destroy();
            }

            const sourcesData = {
                'No Data': 1
            };

            chartInstances.sources = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: Object.keys(sourcesData),
                    datasets: [{
                        data: Object.values(sourcesData),
                        backgroundColor: ['#64748b'],
                        borderWidth: 3,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            // Source distribution chart
            const ctx2 = document.getElementById('source-distribution-chart').getContext('2d');
            
            if (chartInstances.sourceDistribution) {
                chartInstances.sourceDistribution.destroy();
            }

            chartInstances.sourceDistribution = new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: Object.keys(sourcesData),
                    datasets: [{
                        label: 'Posts',
                        data: Object.values(sourcesData),
                        backgroundColor: ['#64748b'],
                        borderRadius: 8
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: { precision: 0 }
                        }
                    },
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
        }

        function createPlaceholderHourlyChart() {
            const ctx = document.getElementById('hourly-overview-chart').getContext('2d');
            
            if (chartInstances.hourly) {
                chartInstances.hourly.destroy();
            }

            // Create empty hourly data
            const hourlyData = {};
            for (let i = 0; i < 24; i++) {
                hourlyData[i] = 0;
            }

            const hourlyArray = Object.entries(hourlyData)
                .map(([hour, count]) => ({ hour: parseInt(hour), count }))
                .sort((a, b) => a.hour - b.hour);

            chartInstances.hourly = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: hourlyArray.map(item => `${item.hour}:00`),
                    datasets: [{
                        label: 'Posts per Hour',
                        data: hourlyArray.map(item => item.count),
                        backgroundColor: 'rgba(248, 163, 82, 0.3)',
                        borderColor: '#d94236',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: '#d94236',
                        pointBorderColor: '#fff',
                        pointRadius: 6,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { precision: 0 }
                        }
                    },
                    plugins: {
                        legend: { display: false }
                    }
                }
            });

            // Also create pattern chart
            const ctx2 = document.getElementById('hourly-pattern-chart').getContext('2d');
            
            if (chartInstances.hourlyPattern) {
                chartInstances.hourlyPattern.destroy();
            }

            chartInstances.hourlyPattern = new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: hourlyArray.map(item => `${item.hour}:00`),
                    datasets: [{
                        label: 'Activity Level',
                        data: hourlyArray.map(item => item.count),
                        backgroundColor: hourlyArray.map(item => '#64748b'),
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { precision: 0 }
                        }
                    },
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
        }

        function createPlaceholderCountryChart() {
            const ctx = document.getElementById('country-overview-chart').getContext('2d');
            
            if (chartInstances.countries) {
                chartInstances.countries.destroy();
            }

            const countriesData = {
                'No Data': 1
            };

            chartInstances.countries = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(countriesData),
                    datasets: [{
                        label: 'Posts',
                        data: Object.values(countriesData),
                        backgroundColor: ['#64748b'],
                        borderRadius: 6
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: { precision: 0 }
                        }
                    },
                    plugins: {
                        legend: { display: false }
                    }
                }
            });

            // Also create geographic chart
            const ctx2 = document.getElementById('geographic-chart').getContext('2d');
            
            if (chartInstances.geographic) {
                chartInstances.geographic.destroy();
            }

            chartInstances.geographic = new Chart(ctx2, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(countriesData),
                    datasets: [{
                        label: 'Posts by Country',
                        data: Object.values(countriesData),
                        backgroundColor: ['#64748b'],
                        borderColor: '#ffffff',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                        },
                        title: {
                            display: true,
                            text: 'Limited Geographic Data'
                        }
                    }
                }
            });
        }

        function createPlaceholderAIKeywordsChart() {
            const ctx = document.getElementById('ai-keywords-chart').getContext('2d');
            
            if (chartInstances.aiKeywords) {
                chartInstances.aiKeywords.destroy();
            }

            const aiKeywords = {
                'artificial intelligence': 45,
                'machine learning': 32,
                'deep learning': 28,
                'neural networks': 24,
                'AI automation': 20
            };

            const sortedKeywords = Object.entries(aiKeywords).sort((a, b) => b[1] - a[1]).slice(0, 10);

            chartInstances.aiKeywords = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedKeywords.map(kw => kw[0]),
                    datasets: [{
                        label: 'Keyword Mentions',
                        data: sortedKeywords.map(kw => kw[1]),
                        backgroundColor: '#f8a352',
                        borderColor: '#d94236',
                        borderWidth: 2,
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        function updateTrendsTab(allAiKeywords) {
            document.getElementById('ai-total-mentions').textContent = formatNumber(Object.values(allAiKeywords).reduce((a, b) => a + b, 0));
            document.getElementById('trending-topics').textContent = Object.keys(allAiKeywords).length;

            const sortedKeywords = Object.entries(allAiKeywords).sort((a, b) => b[1] - a[1]);
            document.getElementById('dominant-category').textContent = sortedKeywords.length > 0 ? sortedKeywords[0][0] : 'N/A';

            document.getElementById('peak-times-display').innerHTML = '<div class="text-gray-500">No hourly data available</div>';
            document.getElementById('weekly-activity-display').innerHTML = '<div class="text-gray-500">Weekly data not available in current dataset</div>';
            document.getElementById('top-content-display').innerHTML = '<div class="text-gray-500">No top content data available</div>';
        }

        function showErrorMessage() {
            const containers = [
                'articles-container',
                'ai-keywords-display',
                'hashtags-display'
            ];
            
            containers.forEach(containerId => {
                const container = document.getElementById(containerId);
                if (container) {
                    container.innerHTML = `
                        <div class="text-center py-8 text-red-500">
                            <div class="text-lg mb-2">‚ö†Ô∏è Error Loading Data</div>
                            <div class="text-sm">Please check if the data file exists and try refreshing the page.</div>
                            <button onclick="location.reload()" class="mt-4 bg-brand-orange hover:bg-brand-red text-white px-4 py-2 rounded">
                                Refresh Page
                            </button>
                        </div>
                    `;
                }
            });
        }

        // Utility functions
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function getArticleAge(dateString) {
            const articleDate = new Date(dateString);
            const now = new Date();
            const diffTime = Math.abs(now - articleDate);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays <= 3) return 'new';
            if (diffDays <= 7) return 'this-week';
            return 'older';
        }

        // Enhanced error handling
        window.addEventListener('error', function(event) {
            console.error('Dashboard error:', event.error);
            
            const errorContainer = document.createElement('div');
            errorContainer.className = 'fixed top-4 right-4 bg-red-500 text-white p-4 rounded-lg shadow-lg z-50 max-w-md';
            errorContainer.innerHTML = `
                <div class="flex items-center gap-2">
                    <span>‚ö†Ô∏è</span>
                    <div class="flex-1">
                        <div class="font-semibold">Dashboard Error</div>
                        <div class="text-sm">Please refresh the page or contact support</div>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" class="text-white hover:text-gray-200">√ó</button>
                </div>
            `;
            document.body.appendChild(errorContainer);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (errorContainer.parentElement) {
                    errorContainer.remove();
                }
            }, 5000);
        });

        // Export functionality
        function exportArticlesData() {
            const exportData = {
                metadata: {
                    exportDate: new Date().toISOString(),
                    totalArticles: allArticles.length,
                    filteredArticles: filteredArticles.length
                },
                articles: filteredArticles
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `ai-articles-export-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }

        // Add export button functionality
        setTimeout(() => {
            const exportButton = document.createElement('button');
            exportButton.className = 'fixed bottom-4 right-4 bg-brand-orange hover:bg-brand-red text-white px-4 py-2 rounded-full shadow-lg transition-colors z-40';
            exportButton.innerHTML = 'üì• Export Articles';
            exportButton.onclick = exportArticlesData;
            exportButton.style.display = 'none';
            
            // Show export button only on articles tab
            document.querySelector('[data-tab="articles"]').addEventListener('click', () => {
                exportButton.style.display = 'block';
            });
            
            document.querySelectorAll('.tab-button').forEach(btn => {
                if (btn.getAttribute('data-tab') !== 'articles') {
                    btn.addEventListener('click', () => {
                        exportButton.style.display = 'none';
                    });
                }
            });
            
            document.body.appendChild(exportButton);
        }, 1000);

        // Responsive chart handling
        function handleChartResize() {
            Object.values(chartInstances).forEach(chart => {
                if (chart && typeof chart.resize === 'function') {
                    try {
                        chart.resize();
                    } catch (e) {
                        console.warn('Chart resize error:', e);
                    }
                }
            });
        }

        window.addEventListener('resize', debounce(handleChartResize, 250));

        // Cleanup on page unload
        window.addEventListener('beforeunload', function() {
            Object.values(chartInstances).forEach(chart => {
                if (chart && typeof chart.destroy === 'function') {
                    chart.destroy();
                }
            });
        });

        console.log('‚úÖ Enhanced AI Dashboard script loaded and ready!');
    </script>
</body>
</html>
